untar(dest)
raw_data_dir
untar(dest, exdir = raw_data_dir)
file.remove(dest)
raw_data_dir
install.packages("hdf5r")
# Download data
args <- commandArgs(trailingOnly = TRUE)
code_dir <- if (is.na(args[1])) "/Users/timbarry/Box/SCEPTRE/sceptre_paper/" else args[1]
source(paste0(code_dir, "/analysis_drivers_xie/paths_to_dirs.R"))
dest <- paste0(raw_data_dir, "/GSE129837_RAW.tar")
paste0(1:5, "_", 1:2)
expand.grid(b1 = 1:5, b2 = 1:2)
g <- expand.grid(b1 = 1:5, b2 = 1:2)
map(.x = 1:nrow(g), .f = function(r) {
print(r[["b1"]], r[["b2"]])
})
map(.x = 1:nrow(g), .f = function(r) {
print(g[[r, "b1"]], g[[r, "b2"]])
})
paste0("GSM3722737_sgRNA-enrichment_5K-sgRNAs_Batch_", g[[r, "b1"]], "_", g[[r, "b2"]], "_sgRNA_UMI.txt.gz")
r
r <- 1
paste0("GSM3722737_sgRNA-enrichment_5K-sgRNAs_Batch_", g[[r, "b1"]], "_", g[[r, "b2"]], "_sgRNA_UMI.txt.gz")
# Unzip the gRNA UMI count files
g <- expand.grid(b1 = 1:5, b2 = 1:2)
file_names <- map(.x = 1:nrow(g), .f = function(r) {
paste0("GSM3722737_sgRNA-enrichment_5K-sgRNAs_Batch_", g[[r, "b1"]], "_", g[[r, "b2"]], "_sgRNA_UMI.txt.gz")
})
file_names
file_names <- map(.x = 1:nrow(g), .f = function(r) {
paste0("GSM3722737_sgRNA-enrichment_5K-sgRNAs_Batch_", g[[r, "b1"]], "_", g[[r, "b2"]], "_sgRNA_UMI.txt.gz")
}) %>% unlist()
file_names
file_names <- map(.x = 1:nrow(g), .f = function(r) {
paste0("GSM3722737_sgRNA-enrichment_5K-sgRNAs_Batch_", g[[r, "b1"]], "_", g[[r, "b2"]], "_sgRNA_UMI.txt.gz")
}) %>% unlist()
paste0()
file_names
paste0(raw_data_dir, "/", file_names)
full_file_paths <- paste0(raw_data_dir, "/", file_names)
funzip
gunzip
require(R.utils)
suppressPackageStartupMessages(library(R.utils))
gunzip(full_file_paths)
file_names[1]
full_file_paths
full_file_pathsp1
full_file_paths[1]
file.exists(full_file_paths[1])
file.exists(full_file_paths[2])
raw_data_dir
paste0(raw_data_dir, "/", "GSM3722736_K562-dCas9-KRAB_5K-sgRNAs_Batch-5_2_filtered_gene_bc_matrices_h5.h5")
paste0(raw_data_dir, "/", "GSM3722736_K562-dCas9-KRAB_5K-sgRNAs_Batch-5_2_filtered_gene_bc_matrices_h5.h5") %>% file.exists()
paste0(raw_data_dir, "/", "GSM3722737_sgRNA-enrichment_5K-sgRNAs_Batch_4_1_sgRNA_UMI.txt.gz") %>% file.exists()
paste0(raw_data_dir, "/", "GSM3722737_sgRNA-enrichment_5K-sgRNAs_Batch_4_1_sgRNA_UMI.txt.gz")
full_file_paths[1]
paste0(raw_data_dir, "/GSM3722739_sgRNA-enrichment_5K-sgRNAs_Batch_1_1_sgRNA_UMI.txt.gz")
paste0(raw_data_dir, "/GSM3722739_sgRNA-enrichment_5K-sgRNAs_Batch_1_1_sgRNA_UMI.txt.gz") %>% file.exist()
paste0(raw_data_dir, "/GSM3722739_sgRNA-enrichment_5K-sgRNAs_Batch_1_1_sgRNA_UMI.txt.gz") %>% file.exists()
paste0(raw_data_dir, "/GSM3722739_sgRNA-enrichment_5K-sgRNAs_Batch_1_1_sgRNA_UMI.txt.gz")
full_file_paths[1]
file.exists(full_file_paths[1])
"/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722739_sgRNA-enrichment_5K-sgRNAs_Batch_1_1_sgRNA_UMI.txt.gz" == full_file_paths[1]
full_file_paths
full_file_paths[1]
"/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722739_sgRNA-enrichment_5K-sgRNAs_Batch_1_1_sgRNA_UMI.txt.gz"
"GSM3722737_sgRNA-enrichment_5K-sgRNAs_Batch_1_1_sgRNA_UMI.txt.gz" == "GSM3722739_sgRNA-enrichment_5K-sgRNAs_Batch_1_1_sgRNA_UMI.txt.gz"
a <- "GSM3722737_sgRNA-enrichment_5K-sgRNAs_Batch_1_1_sgRNA_UMI.txt.gz"
b <- "GSM3722739_sgRNA-enrichment_5K-sgRNAs_Batch_1_1_sgRNA_UMI.txt.gz"
Reduce(setdiff, strsplit(c(a, b), split = ""))
strsplit(c(a, b), split = "")
strsplit(c(a, b), split = "")[[1]] == strsplit(c(a, b), split = "")[[2]]
a
a == b
"hi" == "hi"
a
b
args <- commandArgs(trailingOnly = TRUE)
code_dir <- if (is.na(args[1])) "/Users/timbarry/Box/SCEPTRE/sceptre_paper/" else args[1]
source(paste0(code_dir, "/analysis_drivers_xie/paths_to_dirs.R"))
suppressPackageStartupMessages(library(R.utils))
args <- commandArgs(trailingOnly = TRUE)
code_dir <- if (is.na(args[1])) "/Users/timbarry/Box/SCEPTRE/sceptre_paper/" else args[1]
source(paste0(code_dir, "/analysis_drivers_xie/paths_to_dirs.R"))
suppressPackageStartupMessages(library(R.utils))
# Download data
args <- commandArgs(trailingOnly = TRUE)
code_dir <- if (is.na(args[1])) "/Users/timbarry/Box/SCEPTRE/sceptre_paper/" else args[1]
args
args[1]
# Download data
args <- commandArgs(trailingOnly = TRUE)
args
args[1]
# Download data
args <- commandArgs(trailingOnly = TRUE)
args
c
code_dir <- if (is.na(args[1])) "/Users/timbarry/Box/SCEPTRE/sceptre_paper/" else args[1]
source(paste0(code_dir, "/analysis_drivers_xie/paths_to_dirs.R"))
suppressPackageStartupMessages(library(R.utils))
# Unzip the gRNA UMI count files
gz_files <- list.files(raw_data_dir)
gz_files
# Unzip the gRNA UMI count files
all_file_names <- list.files(raw_data_dir)
grep(pattern = '*.gz', x = all_file_names)
grep(pattern = '*.gz', x = all_file_names, value = TRUE)
paste0(results_dir, grep(pattern = '*.gz', x = all_file_names, value = TRUE))
paste0(results_dir, "/", grep(pattern = '*.gz', x = all_file_names, value = TRUE))
to_unzip <- paste0(results_dir, "/", grep(pattern = '*.gz', x = all_file_names, value = TRUE))
to_unzup
to_unzip
gunzip(to_unzip)
to_unzip
to_unzip[1]
file.exists(to_unzip[1])
# Unzip the gRNA UMI count files
all_file_names <- list.files(raw_data_dir)
all_file_names
to_unzip
to_unzip <- paste0(raw_data_dir, "/", grep(pattern = '*.gz', x = all_file_names, value = TRUE))
file.exists(to_unzip)
gunzip(to_unzip)
gunzip(to_unzip[1])
to_unzip
all_file_names <- list.files(raw_data_dir)
to_unzip <- paste0(raw_data_dir, "/", grep(pattern = '*.gz', x = all_file_names, value = TRUE))
for (file in to_unzip) {
if (file.exists(file)) {
gunzip(file)
}
}
to_unzip
read_tsv(file = "/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722738_sgRNA-enrichment_5K-sgRNAs_Batch_4_2_sgRNA_UMI.txt")
?read_tsv
x <- read_tsv(file = "/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722738_sgRNA-enrichment_5K-sgRNAs_Batch_4_2_sgRNA_UMI.txt")
x
install.packages("BiocManager")
BiocManager::install("rhdf5")
suppressPackageStartupMessages(library(rhdf5))
suppressPackageStartupMessages(library(rhdf5))
x <- H5Fopen(paste0(raw_data_dir, "/GSM3722727_K562-dCas9-KRAB_5K-sgRNAs_Batch-4_1_filtered_gene_bc_matrices_h5.h5"))
x
str(x)
class(x)
x@ID
x@native
x
attr(x)
attributes(x)
x
head()
x
x&'refgenome_hg38_CROP-Guide-MS2-2.1.0'
x_in_mem <- x$'refgenome_hg38_CROP-Guide-MS2-2.1.0'
x_in_mem$barcodes %>% head()
x_in_mem$data %>% head
x_in_mem$gene_names %>% head()
x_in_mem$genes %>% head()
x_in_mem$indices %>% head()
x_in_mem$indices %>% length()
x_in_mem$data %>% length()
x_in_mem$indices %>% head()
x_in_mem$indices %>% tail()
x_in_mem$shape %>%  head()
x_in_mem$shape
x_in_mem$shape
x_in_mem$indptr %>% length()
x_in_mem
x_in_mem$shape
x_in_mem$barcodes %>% length()
x_in_mem$data %>% length()
x_in_mem$gene_names %>% length()
x_in_mem$gene_names
x_in_mem$genes
x_in_mem$genes %>% length()
(x_in_mem$genes %>% length())/3
(x_in_mem$genes %>% length())/5
x_in_mem
x_in_mem$gene_names %>% head()
x_in_mem$genes %>% head()
grep(pattern = "ENSG00000223972", x = x_in_mem$genes )
gsub(pattern = ".[0-9]", replacement = "", x = x_in_mem$genes)
gsub(pattern = "\.[0-9]", replacement = "", x = x_in_mem$genes)
gsub(pattern = "\\.[0-9]", replacement = "", x = x_in_mem$genes)
gsub(pattern = "\\.[0-9]", replacement = "", x = x_in_mem$genes) %>% unique()
gsub(pattern = "\\.[0-9]", replacement = "", x = x_in_mem$genes) %>% unique() %>% length()
x_in_mem$indices %>% head()
x_in_mem$indices $>$ length()
x_in_mem$indices %>% length()
x_in_mem$indptr %>% head()
x_in_mem$indptr %>% length
x_in_mem$shape
x_in_mem$barcodes %>% length()
7942 * 8
x_in_mem$gene_names %>% head()
x_in_mem$genes %>% head()
x_in_mem$barcodes
x_in_mem$data
x_in_mem$gene_names
x_in_mem$gene_names %>% unique()
x_in_mem$gene_names %>% unique() %>% length()
# x <- read_tsv(file = "/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722738_sgRNA-enrichment_5K-sgRNAs_Batch_4_2_sgRNA_UMI.txt")
x <- H5Fopen(paste0(raw_data_dir, "GSM3722728_K562-dCas9-KRAB_5K-sgRNAs_Batch-4_2_filtered_gene_bc_matrices_h5.h5"))
clos(x)
close(x)
H5Dclose(x)
h5closeAll(x)
args <- commandArgs(trailingOnly = TRUE)
code_dir <- if (is.na(args[1])) "/Users/timbarry/Box/SCEPTRE/sceptre_paper/" else args[1]
source(paste0(code_dir, "/analysis_drivers_xie/paths_to_dirs.R"))
suppressPackageStartupMessages(library(R.utils))
suppressPackageStartupMessages(library(rhdf5))
# x <- read_tsv(file = "/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722738_sgRNA-enrichment_5K-sgRNAs_Batch_4_2_sgRNA_UMI.txt")
x <- H5Fopen(paste0(raw_data_dir, "GSM3722728_K562-dCas9-KRAB_5K-sgRNAs_Batch-4_2_filtered_gene_bc_matrices_h5.h5"))
# x <- read_tsv(file = "/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722738_sgRNA-enrichment_5K-sgRNAs_Batch_4_2_sgRNA_UMI.txt")
x <- H5Fopen(paste0(raw_data_dir, "GSM3722729_K562-dCas9-KRAB_5K-sgRNAs_Batch-1_1_filtered_gene_bc_matrices_h5.h5"))
# x <- read_tsv(file = "/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722738_sgRNA-enrichment_5K-sgRNAs_Batch_4_2_sgRNA_UMI.txt")
x <- H5Fopen(paste0(raw_data_dir, "GSM3722730_K562-dCas9-KRAB_5K-sgRNAs_Batch-1_2_filtered_gene_bc_matrices_h5.h5"))
# x <- read_tsv(file = "/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722738_sgRNA-enrichment_5K-sgRNAs_Batch_4_2_sgRNA_UMI.txt")
x <- H5Fopen(paste0(raw_data_dir, "GSM3722730_K562-dCas9-KRAB_5K-sgRNAs_Batch-1_2_filtered_gene_bc_matrices_h5.h5"))
# x <- read_tsv(file = "/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722738_sgRNA-enrichment_5K-sgRNAs_Batch_4_2_sgRNA_UMI.txt")
x <- H5Fopen(paste0(raw_data_dir, "GSM3722730_K562-dCas9-KRAB_5K-sgRNAs_Batch-1_2_filtered_gene_bc_matrices_h5.h5"))
# x <- read_tsv(file = "/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722738_sgRNA-enrichment_5K-sgRNAs_Batch_4_2_sgRNA_UMI.txt")
x <- H5Fopen(paste0(raw_data_dir, "GSM3722730_K562-dCas9-KRAB_5K-sgRNAs_Batch-1_2_filtered_gene_bc_matrices_h5.h5"))
x
# x <- read_tsv(file = "/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722738_sgRNA-enrichment_5K-sgRNAs_Batch_4_2_sgRNA_UMI.txt")
x <- H5Fopen(paste0(raw_data_dir, "GSM3722730_K562-dCas9-KRAB_5K-sgRNAs_Batch-1_2_filtered_gene_bc_matrices_h5.h5"))
# x <- read_tsv(file = "/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722738_sgRNA-enrichment_5K-sgRNAs_Batch_4_2_sgRNA_UMI.txt")
x <- H5Fopen(paste0(raw_data_dir, "GSM3722727_K562-dCas9-KRAB_5K-sgRNAs_Batch-4_1_filtered_gene_bc_matrices_h5.h5"))
raw_data_dir
# x <- read_tsv(file = "/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722738_sgRNA-enrichment_5K-sgRNAs_Batch_4_2_sgRNA_UMI.txt")
x <- H5Fopen(paste0(raw_data_dir, "/GSM3722728_K562-dCas9-KRAB_5K-sgRNAs_Batch-4_2_filtered_gene_bc_matrices_h5.h5"))
x
x&'refgenome_hg38_CROP-Guide-MS2-2.1.0' # extract some information about
x_in_mem <- x$'refgenome_hg38_CROP-Guide-MS2-2.1.0'
x_in_mem
x_in_mem$barcodes %>% head()
x_in_mem$indptr %>% heaD()
x_in_mem$indptr %>% head()
h5closeAll(x) # close the connection to the hd5f file
h5closeAll() # close the connection to the hd5f file
x
# x <- read_tsv(file = "/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722738_sgRNA-enrichment_5K-sgRNAs_Batch_4_2_sgRNA_UMI.txt")
x <- H5Fopen(paste0(raw_data_dir, "/GSM3722728_K562-dCas9-KRAB_5K-sgRNAs_Batch-4_2_filtered_gene_bc_matrices_h5.h5"))
# Download data
args <- commandArgs(trailingOnly = TRUE)
code_dir <- if (is.na(args[1])) "/Users/timbarry/Box/SCEPTRE/sceptre_paper/" else args[1]
source(paste0(code_dir, "/analysis_drivers_xie/paths_to_dirs.R"))
suppressPackageStartupMessages(library(R.utils))
suppressPackageStartupMessages(library(rhdf5))
# x <- read_tsv(file = "/Volumes/tims_new_drive/research/sceptre_files/data/xie/raw/GSM3722738_sgRNA-enrichment_5K-sgRNAs_Batch_4_2_sgRNA_UMI.txt")
x <- H5Fopen(paste0(raw_data_dir, "/GSM3722728_K562-dCas9-KRAB_5K-sgRNAs_Batch-4_2_filtered_gene_bc_matrices_h5.h5"))
x&'refgenome_hg38_CROP-Guide-MS2-2.1.0' # extract some information about
x_in_mem <- x$'refgenome_hg38_CROP-Guide-MS2-2.1.0'
str(x_in_mem)
x&'refgenome_hg38_CROP-Guide-MS2-2.1.0' # extract some information about
x_in_mem$gene_names %>% head()
x_in_mem$genes %>% head()
x_in_mem$genes %>% tail()
x_in_mem$gene_names %>% tail()
x_in_mem$gene_names %>% tail(500)
x_in_mem$gene_names %>% tail(5000)
x_in_mem$gene_names %>% head()
x&'refgenome_hg38_CROP-Guide-MS2-2.1.0' # extract some information about
x_in_mem$shape
x_in_mem$barcodes %>% head(1000)
args <- commandArgs(trailingOnly = TRUE)
code_dir <- if (is.na(args[1])) "/Users/timbarry/Box/SCEPTRE/sceptre_paper/" else args[1]
source(paste0(code_dir, "/analysis_drivers_xie/paths_to_dirs.R"))
suppressPackageStartupMessages(library(R.utils))
args
code_dir
suppressPackageStartupMessages(library(rhdf5))
# First, we pre-process the expression matrices; this involves loading each expression matrix, extracting the UMI counts, and storing in a file-backed matrix.
h5_exp_mat <- H5Fopen(paste0(raw_data_dir, "/GSM3722727_K562-dCas9-KRAB_5K-sgRNAs_Batch-4_1_filtered_gene_bc_matrices_h5.h5"))
h5_exp_mat
h5ls(h5_exp_mat)
# Pre-process data
args <- commandArgs(trailingOnly = TRUE)
code_dir <- if (is.na(args[1])) "/Users/timbarry/Box/SCEPTRE/sceptre_paper/" else args[1]
source(paste0(code_dir, "/analysis_drivers_xie/paths_to_dirs.R"))
suppressPackageStartupMessages(library(rhdf5))
# First, we pre-process the expression matrices; this involves loading each expression matrix, extracting the UMI counts, and storing in a file-backed matrix.
h5_exp_mat <- H5Fopen(paste0(raw_data_dir, "/GSM3722727_K562-dCas9-KRAB_5K-sgRNAs_Batch-4_1_filtered_gene_bc_matrices_h5.h5"))
h5_exp_mat
h5ls(h5_exp_mat) # nothing in root directory; all data stored in sub-directory refgenome_hg38_CROP-Guide-MS2-2.1.0; datasets include barcodes, data, gene_names, genes, indices, indptr, and shape.
h5_exp_mat
# First, we pre-process the expression matrices; this involves loading each expression matrix, extracting the UMI counts, and storing in a file-backed matrix.
h5_exp_mat <- H5Fopen(paste0(raw_data_dir, "/GSM3722727_K562-dCas9-KRAB_5K-sgRNAs_Batch-4_1_filtered_gene_bc_matrices_h5.h5"))
h5_exp_mat
h5_obj <- h5_exp_mat
h5_obj
class(h5_obj)
h5ls(h5_obj)
h5_obj
h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/barcodes"
h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/barcodes"
dat <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/data"
head(dat)
dat <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/indices"
9
dat <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/data"
indices <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/indices"
ind_ptr <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/ind_ptr"
h5ls(h5_obj)
ind_ptr <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/indptr"
dat
indices
ind_ptr
h5_obj$refgenome_hg38_CROP-Guide-MS2-2.1.0$data
h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0"$data
h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0"$dim
h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0"$shape
length(ind_ptr)
head(dat)
head(indices)
head(ind_ptr)
head(column_no)
head(dat)
head(indices)
head(ind_ptr)
column_no
column_no <- 1
dat
indices
ind_ptr %>% tail()
indices[column_no]
indices[ind_ptr]
head(indices)
indices[ind_ptr]
head(ind_ptr)
indices[ind_ptr]
ind_ptr[column_no]
head(ind_ptr)
column_no
column_no + 1
start_idx <- ind_ptr[column_no]
end_idx <- ind_ptr[column_no + 1]
start_idx
head(start_idx)
head(end_idx)
head(idx_ptr)
head(ind_ptr)
start_idx <- ind_ptr[column_no] + 1
end_idx <- ind_ptr[column_no + 1] + 1
start_idx
end_idx
head(dat)
start_idx
end_idx
start_idx
end_idx
dat_out <- dat[start_idx:end_idx]
head(dat_out)
indices
indeces_out <- indices[start_idx:end_idx]
head(dat_out)
indices_out <- indices[start_idx:end_idx]
head(indices_out)
head(indices_out)
indices_out <- indices[start_idx:end_idx] + 1
indicesou_out
indices_out <- indices[start_idx:end_idx] + 1
indices_out
head(indices_out)
idx_range <- ind_ptr[column_no:(column_no + 1)] + 1
idx_range
dat_out <- dat[idx_range]
head(dat_out)
idx_rangeidx_range
idx_range
idx_range
head(dat)
dat[idx_range]
max(ind_ptr)
2^32
max(indices)
# Pre-process data
args <- commandArgs(trailingOnly = TRUE)
code_dir <- if (is.na(args[1])) "/Users/timbarry/Box/SCEPTRE/sceptre_paper/" else args[1]
source(paste0(code_dir, "/analysis_drivers_xie/paths_to_dirs.R"))
suppressPackageStartupMessages(library(rhdf5))
h5_obj <- H5Fopen(paste0(raw_data_dir, "/GSM3722727_K562-dCas9-KRAB_5K-sgRNAs_Batch-4_1_filtered_gene_bc_matrices_h5.h5"))
dat <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/data"
indices <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/indices"
ind_ptr <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/indptr"
n_rows <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/shape"[1]
n_cols <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/shape"[2]
head(Dat)
head(dat)
head(indices)
head(ind_ptr)
n_rwos
n_rows
n_cols
column_no
column_no <- 1
head(dat)
head(indices)
head(ind_ptr)
ehad(n_rows)
head(n_rows)
if (zero_based_idx) { # make the vectors use 1-based indexing
indices <- indices + 1
ind_ptr <- ind_ptr + 1
}
zero_based_idx = TRUE
if (zero_based_idx) { # make the vectors use 1-based indexing
indices <- indices + 1
ind_ptr <- ind_ptr + 1
}
indices %>% head()
head(ind_ptr)
[column_no:(column_no + 1)
column_no:(column_no + 1)
ind_ptr[column_no:(column_no + 1)]
internal_idx_range <- ind_ptr[column_no:(column_no + 1)] + c(0,-1)
head(internal_idx_range)
internal_idx_range <- ind_ptr[column_no:(column_no + 1)] + c(0,-1)
internal_idx_range
internal_idx_range[1]:internal_idx_range[2]
non_zero_out <- dat[internal_idx_range[1]:internal_idx_range[2]]
non_zero_out
internal_idx_range[1]
internal_idx_range
external_idx <- indices[internal_idx_range[1]:internal_idx_range[2]]
full_out <- rep(0, n_rows)
external_idx_range
external_idx
full_out[external_idx] <- non_zero_out
full_out
column_no <- n_cols
column_no
internal_idx_range <- ind_ptr[column_no:(column_no + 1)] + c(0,-1)
non_zero_out <- dat[internal_idx_range[1]:internal_idx_range[2]]
external_idx <- indices[internal_idx_range[1]:internal_idx_range[2]]
full_out <- rep(0, n_rows)
full_out[external_idx] <- non_zero_out
full_out
column_no <- 1:4
sapply(X = column_no, FUN = function(i) {
internal_idx_range <- ind_ptr[i:(i + 1)] + c(0,-1)
non_zero_out <- dat[internal_idx_range[1]:internal_idx_range[2]]
external_idx <- indices[internal_idx_range[1]:internal_idx_range[2]]
full_out <- rep(0, n_rows)
full_out[external_idx] <- non_zero_out
return(full_out)
})
h5_obj <- H5Fopen(paste0(raw_data_dir, "/GSM3722727_K562-dCas9-KRAB_5K-sgRNAs_Batch-4_1_filtered_gene_bc_matrices_h5.h5"))
args <- commandArgs(trailingOnly = TRUE)
code_dir <- if (is.na(args[1])) "/Users/timbarry/Box/SCEPTRE/sceptre_paper/" else args[1]
source(paste0(code_dir, "/analysis_drivers_xie/paths_to_dirs.R"))
suppressPackageStartupMessages(library(rhdf5))
h5_obj <- H5Fopen(paste0(raw_data_dir, "/GSM3722727_K562-dCas9-KRAB_5K-sgRNAs_Batch-4_1_filtered_gene_bc_matrices_h5.h5"))
dat <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/data"
indices <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/indices"
ind_ptr <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/indptr"
n_rows <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/shape"[1]
n_cols <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/shape"[2]
column_no
sapply(X = column_no, FUN = function(i) {
internal_idx_range <- ind_ptr[i:(i + 1)] + c(0,-1)
non_zero_out <- dat[internal_idx_range[1]:internal_idx_range[2]]
external_idx <- indices[internal_idx_range[1]:internal_idx_range[2]]
full_out <- rep(0, n_rows)
full_out[external_idx] <- non_zero_out
return(full_out)
})
sapply(X = column_no, FUN = function(i) {
internal_idx_range <- ind_ptr[i:(i + 1)] + c(0,-1)
non_zero_out <- dat[internal_idx_range[1]:internal_idx_range[2]]
external_idx <- indices[internal_idx_range[1]:internal_idx_range[2]]
full_out <- rep(0, n_rows)
full_out[external_idx] <- non_zero_out
return(full_out)
})
column_no <- 1:50
sapply(X = column_no, FUN = function(i) {
internal_idx_range <- ind_ptr[i:(i + 1)] + c(0,-1)
non_zero_out <- dat[internal_idx_range[1]:internal_idx_range[2]]
external_idx <- indices[internal_idx_range[1]:internal_idx_range[2]]
full_out <- rep(0, n_rows)
full_out[external_idx] <- non_zero_out
return(full_out)
})
sapply(X = column_no, FUN = function(i) {
internal_idx_range <- ind_ptr[i:(i + 1)] + c(0,-1)
non_zero_out <- dat[internal_idx_range[1]:internal_idx_range[2]]
external_idx <- indices[internal_idx_range[1]:internal_idx_range[2]]
full_out <- rep(0, n_rows)
full_out[external_idx] <- non_zero_out
return(full_out)
})
head(ind_ptr)
max(ind_ptr)
library(sceptre)
args <- commandArgs(trailingOnly = TRUE)
code_dir <- if (is.na(args[1])) "/Users/timbarry/Box/SCEPTRE/sceptre_paper/" else args[1]
source(paste0(code_dir, "/analysis_drivers_xie/paths_to_dirs.R"))
suppressPackageStartupMessages(library(rhdf5))
extract_matrix_from_hdf5 <- function(h5_obj) {
dat <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/data"
indices <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/indices"
ind_ptr <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/indptr"
n_rows <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/shape"[1]
n_cols <- h5_obj$"refgenome_hg38_CROP-Guide-MS2-2.1.0/shape"[2]
}
h5_obj <- H5Fopen(paste0(raw_data_dir, "/GSM3722727_K562-dCas9-KRAB_5K-sgRNAs_Batch-4_1_filtered_gene_bc_matrices_h5.h5"))
