confounder_adjustment_grna =       "percent.mito + prep_batch + log(total_umis) + log(guide_count) + log(gene_count)",
confounder_adjustment_expression = "percent.mito + prep_batch + log(total_umis) + log(guide_count) + log(gene_count)")
resampling_methods
resampling_methods$confounder_adjustment_expression
likelihood_methods = tibble(test = character(), dispersion_estimate = character(), confounder_adjustment = character()) %>%
add_row(test = "z_test",
dispersion_estimate = "size_shrunk",
confounder_adjustment = "percent.mito + prep_batch + guide_count + offset(log(Size_Factor))") %>%
add_row(test = "z_test",
dispersion_estimate = "size_raw",
confounder_adjustment = "percent.mito + prep_batch + guide_count + offset(log(Size_Factor))") %>%
add_row(test = "z_test",
dispersion_estimate = "size_shrunk",
confounder_adjustment = "percent.mito + prep_batch + log(total_umis) + log(guide_count) + log(gene_count)") %>%
add_row(test = "z_test",
dispersion_estimate = "size_raw",
confounder_adjustment = "percent.mito + prep_batch + log(total_umis) + log(guide_count) + log(gene_count)")
likelihood_methods
# number of CRT resamples
B = 500
# number of gene-enhancer pairs per experiment
pairs_per_task = 12591
genes_per_task = 212
grnas_per_task = 2200
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
# 3. Create and save the covariate matrix that we will use in the regressions.
cell_covariates <- read.fst(x = cell_covariates, path = paste0(processed_dir, "/cell_covariates_all.fst"))
require(sceptre)
paste0(processed_dir, "/cell_covariates_all.fst")
processed_dir <- paste0(offsite_dir, "/data/gasperini/processed")
raw_data_dir <-  paste0(offsite_dir, "/data/gasperini/raw")
# 3. Create and save the covariate matrix that we will use in the regressions.
cell_covariates <- read.fst(paste0(processed_dir, "/cell_covariates_all.fst"))
gRNA_indicators <- read.fst(paste0(processed_dir, "/gRNA_indicators.fst"))
cell_covariates
class(cell_covariates)
colnames(cell_covariates)
cell_covariates$sample
cell_covariates$gene
cell_covariates$percent.mito
cell_covariates$sample %>% ununique())
cell_covariates$sample %>% ununique()
cell_covariates$sample %>% unique()
cell_covariates$prep_batch %>% unique()
cell_covariates_model <- summarize(cell_covariates, p_mito = cell_covariates$percent.mito, prep_batch = cell_covariates$prep_batch, lg_total_umis = log(cell_covariates$total_umis), lg_guide_count = log(cell_covariates$guide_count))
head(cell_covariates_model)
paste0(processed_dir, "/expression_FBM_metadata.rds")
9
9
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
processed_dir <- paste0(offsite_dir, "/data/gasperini/processed")
raw_data_dir <-  paste0(offsite_dir, "/data/gasperini/raw")
processed_dir
raw_data_dir
# 3. Create and save the covariate matrix that we will use in the regressions.
cell_covariates <- read.fst(paste0(processed_dir, "/cell_covariates_all.fst"))
require(sceptre)
# 3. Create and save the covariate matrix that we will use in the regressions.
cell_covariates <- read.fst(paste0(processed_dir, "/cell_covariates_all.fst"))
gRNA_indicators <- read.fst(paste0(processed_dir, "/gRNA_indicators.fst"))
rm(gRNA_indicators)
gc()
# Determine the number of expressed genes in each cell
fbm_metadata_exp_t <- readRDS(paste0(processed_dir, "/expression_FBM_metadata.rds"))
9
exp_mat_t <- load_fbm(fbm_metadata_exp_t)
exp_mat_t
exp_mat_t[1,1:10]
exp_mat_t[10,1:10]
n_genes <- big_apply(exp_mat_t, function(X, ind) {colSums(X[,ind] > 0)}, ncores = 3)
head(n_genes)
n_genes <- big_apply(exp_mat_t, function(X, ind) {colSums(X[,ind] > 0)})
head(n_genes)
exp_mat_t[,1]
c1 <- exp_mat_t[,1]
length(c1)
# Determine the number of expressed genes in each cell
fbm_metadata_exp_t <- readRDS(paste0(processed_dir, "/expression_FBM_metadata_t.rds"))
# Determine the number of expressed genes in each cell
fbm_metadata_exp_t <- readRDS(paste0(processed_dir, "/expression_FBM_t_metadata.rds"))
exp_mat_t <- load_fbm(fbm_metadata_exp_t)
c1 <- exp_mat_t[,1]
length(c1)
sum(c1 > 0)
n_genes <- big_apply(exp_mat_t, function(X, ind) {colSums(X[,ind] > 0)})
exp_mat_t[,200:205]
head(n_genes)
n_genes_u <- unlist(n_genes)
head(n_genes_u)
length(n_genes_u)
n_genes <- unlist(n_genes)
all(n_genes > 0)
mutate(cell_covariates_model, lg_n_genes = log(n_genes)) %>% head()
# Identify the first 5 variables and apply appropriate transformations
cell_covariates_model <- summarize(cell_covariates, p_mito = cell_covariates$percent.mito, prep_batch = cell_covariates$prep_batch, lg_total_umis = log(cell_covariates$total_umis), lg_guide_count = log(cell_covariates$guide_count))
mutate(cell_covariates_model, lg_n_genes = log(n_genes)) %>% head()
paste0(processed_dir, "/cell_covariate_model_matrix.fst")
write.fst(cell_covariates_model, paste0(processed_dir, "/cell_covariate_model_matrix.fst"))
13189/2
cell_covariates %>% head()
gRNA_indicators <- read.fst("/Volumes/tims_new_drive/research/sceptre_files/data/gasperini/processed/gRNA_indicators.fst")
head(gRNA_indicators)
row.names(gRNA_indicators) %>% head()
dim(gRNA_indicators)
gRNA_names <- colnames(gRNA_indicators)
head(gRNA_names)
"bassik_mch" %in% gRNA_names
"Klannchr1_HS4" %in% gRNA_names
"pos_control_Klannchr1_HS4" %in% gRNA_names
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
processed_dir <- paste0(offsite_dir, "/data/gasperini/processed")
raw_data_dir <-  paste0(offsite_dir, "/data/gasperini/raw")
paste0(raw_data_dir, "GSE120861_all_deg_results.at_scale.txt")
# 4. Extract the target_site-gRNA pairs to analyze.
all_deg_results <- read_tsv(paste0(raw_data_dir, "GSE120861_all_deg_results.at_scale.txt"), col_types = "cddddddccccciiciiccl")
require(sceptre)
# 4. Extract the target_site-gRNA pairs to analyze.
all_deg_results <- read_tsv(paste0(raw_data_dir, "GSE120861_all_deg_results.at_scale.txt"), col_types = "cddddddccccciiciiccl")
# 4. Extract the target_site-gRNA pairs to analyze.
all_deg_results <- read_tsv(paste0(raw_data_dir, "GSE120861_all_deg_results.at_scale.txt"), col_types = "cddddddccccciiciiccl")
# 4. Extract the target_site-gRNA pairs to analyze.
all_deg_results <- read_tsv(paste0(raw_data_dir, "/GSE120861_all_deg_results.at_scale.txt"), col_types = "cddddddccccciiciiccl")
head(all_deg_results)
# 4. Extract the target_site-gRNA pairs to analyze.
all_deg_results <- suppressWarnings(read_tsv(paste0(raw_data_dir, "/GSE120861_all_deg_results.at_scale.txt"), col_types = "cddddddccccciiciiccl"))
all_deg_results
all_deg_results %>% rename(gene_id = ENSG)
parameters <- all_deg_results %>% rename(gene_id = ENSG) %>% select(gene_id, grna_group)
parameters <- all_deg_results %>% rename(gene_id = ENSG) %>% select(gene_id, gRNA_group)
parameters <- all_deg_results %>% rename(gene_id = ENSG) %>% select(gene_id, gRNA_group) %>% arrange()
parameters
# 4. Extract the target_site-gRNA pairs to analyze.
all_deg_results <- suppressWarnings(read_tsv(paste0(raw_data_dir, "/GSE120861_all_deg_results.at_scale.txt"), col_types = "cddddddccccciiciiccl"))
pairs_to_analyze <- all_deg_results %>% rename(gene_id = ENSG) %>% select(gene_id, gRNA_group) %>% arrange()
pairs_to_analyze
genes <- pairs_to_analyze$gene_id %>% unique()
genes
length(genes)
write.fst(pairs_to_analyze, paste0(processed_dir, "/gene_gRNA_pairs_to_study.fst"))
m <- read.fst(paste0(processed_dir, "/cell_covariate_model_matrix.fst"))
colnames(m)
m <- read.fst(paste0(processed_dir, "/gRNA_indicators.fst"))
colnames(m) %>% head()
dim(m)
paste0(raw_data_dir, "/GSE120861_at_scale_screen.genes.txt")
# 6. Finally, save the (ordered) gene names
gene_ids <- read_tsv(paste0(raw_data_dir, "/GSE120861_at_scale_screen.genes.txt"),
col_names = FALSE, col_types = "c") %>% pull()
head(gene_ids)
head(pairs_to_analyze)
saveRDS(gene_ids, paste0(processed_dir, "ordered_gene_ids.RDS"))
processed_dir
paste0(processed_dir, "ordered_gene_ids.RDS")
saveRDS(gene_ids, paste0(processed_dir, "/ordered_gene_ids.RDS"))
library(sceptre)
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
offsite_dir
# Set up dictionaries
gRNA_gene_pairs <- paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst")
require(sceptre)
# Set up dictionaries
gRNA_gene_pairs <- read.fst(paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst"))
head(gRNA_gene_pairs)
# 1. gRNA precomputations
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
length(gRNAs)
# 1. gRNA precomputations
gRNA_pod_size <- 2200
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
length(gRNAs)/gRNA_pod_size
# 1. gRNA precomputations
gRNA_pod_size <- 400
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
length(gRNAs)/gRNA_pod_size
floor(length(gRNAs)/gRNA_pod_size)
n_pods <- floor(length(gRNAs)/gRNA_pod_size)
n_pods
rep(1:n_pods, each = gRNA_pod_size)
pod_id <- rep(1:n_pods, each = gRNA_pod_size)
pod_id %>% length()
length(gRNAs)
# 1. gRNA precomputations
gRNA_pod_size <- 400
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
n_pods_minus_1 <- floor(length(gRNAs)/gRNA_pod_size)
gRNA_pod_size
pod_id <- rep(1:n_pods_minus_1, each = gRNA_pod_size)
pod_id
length(gRNAs) - pod_id
length(gRNAs) - length(pod_id)
n_pods_minus_1
pod_id_append <- rep(n_pods_minus_1 + 1, times = length(gRNAs) - length(pod_id))
pod_id_append
pod_id <- c(pod_id, pod_id_append)
pod_id
length(pod_id)
table(pod_iod)
table(pod_id)
length(pod_id)
length(gRNAs)
gRNAs <- 1:800
n_pods_minus_1 <- floor(length(gRNAs)/gRNA_pod_size)
n_pods_minus_1
pod_id <- rep(1:n_pods_minus_1, each = gRNA_pod_size)
pod_id
pod_id_append <- rep(n_pods_minus_1 + 1, times = length(gRNAs) - length(pod_id))
pod_id_append
pod_id <- c(pod_id, pod_id_append)
pod_id
length(pod_id)
paste0(offsite_dir, "/data/precomp")
gRNA_precomp_file_name <- paste0(offsite_dir, "/data/precomp/gRNA_precomp_")
gRNA_precomp_file_name
file_names <- paste0(gRNA_precomp_file_name, pod_id, ".fst")
file_names
tibble(gRNA_ids = gRNAs, pod_id = pod_id, precomp_file_name = file_names)
gRNAs
# Set up dictionaries
gRNA_gene_pairs <- read.fst(paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst"))
# 1. gRNA precomputations
gRNA_pod_size <- 400
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
tibble(gRNA_ids = gRNAs, pod_id = pod_id, precomp_file_name = file_names)
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
# Set up dictionaries
gRNA_gene_pairs <- read.fst(paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst"))
# 1. gRNA precomputations
gRNA_pod_size <- 400
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
n_pods_minus_1 <- floor(length(gRNAs)/gRNA_pod_size)
pod_id <- rep(1:n_pods_minus_1, each = gRNA_pod_size)
pod_id_append <- rep(n_pods_minus_1 + 1, times = length(gRNAs) - length(pod_id))
pod_id <- c(pod_id, pod_id_append)
gRNA_precomp_file_name <- paste0(offsite_dir, "/data/precomp/gRNA_precomp_")
file_names <- paste0(gRNA_precomp_file_name, pod_id, ".fst")
tibble(gRNA_ids = gRNAs, pod_id = pod_id, precomp_file_name = file_names)
out <- tibble(gRNA_ids = gRNAs, pod_id = pod_id, precomp_file_name = file_names)
out$precomp_file_name
gRNA_precomp_file_name <- factor(paste0(offsite_dir, "/data/precomp/gRNA_precomp_"))
file_names <- paste0(gRNA_precomp_file_name, pod_id, ".fst")
out <- tibble(gRNA_ids = gRNAs, pod_id = pod_id, precomp_file_name = file_names)
ot
out
out$precomp_file_name
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
# Load the gRNAs and genes to analyze
gRNA_gene_pairs <- read.fst(paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst"))
require(sceptre)
# Load the gRNAs and genes to analyze
gRNA_gene_pairs <- read.fst(paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst"))
10
9
# 1. gRNA precomputations
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
gRNA_dictionary <- create_precomp_dictionary(ids = gRNAs, pod_size = 400, precomp_base_filename = paste0(offsite_dir, "/data/precomp/gRNA_precomp_"))
head(gRNA_dictionary)
write.fst(gRNA_dictionary, paste0(offsite_dir, "/data/precomp/gRNA_dictionary.fst"))
paste0(offsite_dir, "/data/precomp/gRNA_dictionary.fst")
ls
write.fst(gRNA_dictionary, paste0(offsite_dir, "/data/gasperini/precomp/gRNA_dictionary.fst"))
# 2. Gene precomputations
genes <- unique(gRNA_gene_pairs$gene_id)
genes
offsite_directory <- "/Volumes/tims_new_drive/research/sceptre_files"
offsite_directory <- "/Volumes/tims_new_drive/research/sceptre_files"
create_parent_directories <- function(s) {
s_split <- str_split(string = s, pattern = "/")[[1]]
unlist(map(1:length(s_split), function(i) paste0(s_split[1:i], collapse = "/")))
}
library(stringr, quietly = TRUE)
library(purrr, quietly = TRUE)
sub_dirs <- c(create_parent_directories("data/gasperini/raw"), create_parent_directories("data/gasperini/precomp/gRNA"), "data/gasperini/precomp/gene", "data/gasperini/processed",
create_parent_directories("data/Xie/raw"), "data/Xie/processed", "data/Xie/precomp",
create_parent_directories("data/functional"), "data/functional/HIC", "data/functional/ChIP-seq", "data/functional/GeneHancer",
create_parent_directories("results/gasperini"), "results/Xie", "results/simulations",
"figures", "logs") %>% unique()
sub_dirs
# Hardcode the directories to create.
sub_dirs <- c(create_parent_directories("data/gasperini/raw"), create_parent_directories("data/gasperini/precomp/gRNA"), "data/gasperini/precomp/gene", "data/gasperini/processed",
create_parent_directories("data/Xie/raw"), "data/Xie/processed", create_parent_directories("data/Xie/precomp/gRNA"), "data/Xie/precomp/gene",
create_parent_directories("data/functional"), "data/functional/HIC", "data/functional/ChIP-seq", "data/functional/GeneHancer",
create_parent_directories("results/gasperini"), "results/Xie", "results/simulations",
"figures", "logs") %>% unique()
sub_dirs
dirs_to_create <- paste0(offsite_directory, "/", sub_dirs)
for (directory in dirs_to_create) {
if (!dir.exists(directory)) {
dir.create(directory)
}
}
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
# Load the gRNAs and genes to analyze
gRNA_gene_pairs <- read.fst(paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst"))
# 1. gRNA precomputations
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
gRNA_dictionary <- create_precomp_dictionary(ids = gRNAs, pod_size = 400, precomp_base_filename = paste0(offsite_dir, "/data/precomp/gRNA_precomp_"))
gRNA_dictionary <- create_precomp_dictionary(ids = gRNAs, pod_size = 400, precomp_base_filename = paste0(offsite_dir, "/data/precomp/gRNA/gRNA_precomp_"))
gRNA_dictionary
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
# Load the gRNAs and genes to analyze
gRNA_gene_pairs <- read.fst(paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst"))
paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_dictionary.fst")
write.fst(gRNA_dictionary, paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_dictionary.fst"))
# 1. gRNA precomputations
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
gRNA_dictionary <- create_precomp_dictionary(ids = gRNAs, pod_size = 400, precomp_base_filename = paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_precomp_"))
write.fst(gRNA_dictionary, paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_dictionary.fst"))
# 2. Gene precomputations
genes <- unique(gRNA_gene_pairs$gene_id)
offsite_dir
# 2. Gene precomputations
genes <- unique(gRNA_gene_pairs$gene_id)
gene_dictionary <- create_precomp_dictionary(ids = genes, pod_size = 212, precomp_base_filename = paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_precomp_"))
gene_dictionary
gene_dictionary <- create_precomp_dictionary(ids = genes, pod_size = 212, precomp_base_filename = paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_precomp_"))
gene_dictionary
library(sceptre)
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
# Load the gRNAs and genes to analyze
gRNA_gene_pairs <- read.fst(paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst"))
# 1. gRNA precomputations
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
gRNA_dictionary <- create_precomp_dictionary(ids = gRNAs, pod_size = 400, precomp_base_filename = paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_precomp_"))
gRNA_dictionary
write.fst(gRNA_dictionary, paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_dictionary.fst"))
# 2. Gene precomputations
genes <- unique(gRNA_gene_pairs$gene_id)
# 2. Gene precomputations
genes <- unique(gRNA_gene_pairs$gene_id)
gene_dictionary <- create_precomp_dictionary(ids = genes, pod_size = 212, precomp_base_filename = paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_precomp_"))
gene_dictionary %>% head()
write.fst(gRNA_dictionary, paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_dictionary.fst"))
head(gRNA_gene_pairs)
# 3. gRNA-gene pairs
pairs <- create_precomp_dictionary(ids = gRNA_gene_pairs$gRNA_group, pod_size = 2000, precomp_base_filename = paste0(offsite_dir, "/results/gasperini"))
head(pairs)
rename(pairs, id = gRNA)
rename(pairs, id = "gRNA")
rename(pairs, "id"= "gRNA")
rename(pairs, gRNA = id)
rename(pairs, gRNA_id = id) %>% mutate(gene_id = gRNA_gene_pairs$gene_id)
rename(pairs, gRNA_id = id) %>% mutate(gene_id = gRNA_gene_pairs$gene_id) %>% select(gRNA_id, gene_id, pod_id, precomp_file_name)
library(sceptre)
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
gRNA_gene_pairs <- read.fst(paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst"))
# 1. gRNA precomputations
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
gRNA_dictionary <- create_precomp_dictionary(ids = gRNAs, pod_size = 400, precomp_base_filename = paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_precomp_"))
write.fst(gRNA_dictionary, paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_dictionary.fst"))
# 2. Gene precomputations
genes <- unique(gRNA_gene_pairs$gene_id)
gene_dictionary <- create_precomp_dictionary(ids = genes, pod_size = 212, precomp_base_filename = paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_precomp_"))
write.fst(gRNA_dictionary, paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_dictionary.fst"))
# 3. gRNA-gene pairs
pairs <- create_precomp_dictionary(ids = gRNA_gene_pairs$gRNA_group, pod_size = 2000, precomp_base_filename = paste0(offsite_dir, "/results/gasperini"))
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
# Load the gRNAs and genes to analyze
gRNA_gene_pairs <- read.fst(paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst"))
# 1. gRNA precomputations
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
gRNA_dictionary <- create_precomp_dictionary(ids = gRNAs, pod_size = 400, precomp_base_filename = paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_precomp_"))
write.fst(gRNA_dictionary, paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_dictionary.fst"))
gRNA_dictionary
# 2. Gene precomputations
genes <- unique(gRNA_gene_pairs$gene_id)
gene_dictionary <- create_precomp_dictionary(ids = genes, pod_size = 212, precomp_base_filename = paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_precomp_"))
write.fst(gRNA_dictionary, paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_dictionary.fst"))
# 3. gRNA-gene pairs
pairs <- create_precomp_dictionary(ids = gRNA_gene_pairs$gRNA_group, pod_size = 2000, precomp_base_filename = paste0(offsite_dir, "/results/gasperini"))
rename(pairs, gRNA_id = id) %>% mutate(gene_id = gRNA_gene_pairs$gene_id) %>% select(gRNA_id, gene_id, pod_id, precomp_file_name)
rename(pairs, gRNA_id = id) %>% mutate(gene_id = gRNA_gene_pairs$gene_id) %>% select(gRNA_id, gene_id, pod_id, file_name)
write.fst(pairs, paste0(offsite_dir, "/results/gasperini/results_dictionary.fst"))
library(sceptre)
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
# Load the gRNAs and genes to analyze
gRNA_gene_pairs <- read.fst(paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst"))
head(gRNA_gene_pairs)
# 1. gRNA precomputations
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
gRNA_dictionary <- create_precomp_dictionary(ids = gRNAs, pod_size = 400, precomp_base_filename = paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_precomp_"))
gRNA_dictionary <- create_precomp_dictionary(ids = gRNAs, pod_size = 400)
gRNA_dictionary
# 1. gRNA precomputations
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
gRNA_dictionary <- create_precomp_dictionary(ids = gRNAs, pod_size = 400)
precomp_base_filename <- paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_precomp_")
precomp_base_filename
gRNA_dictionary
gRNA_dictionary <- mutate(gRNA_dictionary, precomp_file = paste0(precomp_base_filename, pod_id))
gRNA_dictionary
# 1. gRNA precomputations
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
gRNA_dictionary <- create_precomp_dictionary(ids = gRNAs, pod_size = 400)
precomp_base_filename <- paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_precomp_")
# 1. gRNA precomputations
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
precomp_base_filename <- paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_precomp_")
gRNA_dictionary <- create_precomp_dictionary(ids = gRNAs, pod_size = 400) %>% mutate(precomp_file = factor(paste0(precomp_base_filename, pod_id)))
head(gRNA_dictionary)
head(gRNA_dictionary$precomp_file)
gRNA_dictionary <- create_precomp_dictionary(ids = gRNAs, pod_size = 400) %>% mutate(precomp_file = factor(paste0(precomp_base_filename, pod_id, ".fst")))
head(gRNA_dictionary)
gRNA_dictionary$precomp_file[1]
gRNA_dictionary$precomp_file[1000]
write.fst(gRNA_dictionary, paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_dictionary.fst"))
# 2. Gene precomputations
genes <- unique(gRNA_gene_pairs$gene_id)
head(genes)
# 2. Gene precomputations
genes <- unique(gRNA_gene_pairs$gene_id)
precomp_base_filename <- paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_precomp_")
genes
gene_dictionary <- create_precomp_dictionary(ids = genes, pod_size = 212, )
gene_dictionary <- create_precomp_dictionary(ids = genes, pod_size = 212)
head(gene_dictionary)
gene_dictionary <- create_precomp_dictionary(ids = genes, pod_size = 212) %>% mutate(precomp_file = factor(paste0(precomp_base_filename, pod_id, ".fst")))
head(gene_dictionary)
gene_dictionary$precomp_file[1]
write.fst(gene_dictionary, paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_dictionary.fst"))
c
gene_dictionary <- create_precomp_dictionary(ids = genes, pod_size = 212) %>% mutate(offset_file = factor(paste0("/data/gasperini/precomp/gene/gene_offsets_", pod_id, ".fst")))
head(gene_dictionary)
# 1. gRNA precomputations
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
gRNA_dictionary <- create_precomp_dictionary(ids = gRNAs, pod_size = 400) %>% mutate(precomp_file = factor(paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_precomp_", pod_id, ".fst")))
head(gRNA_dictionary)
head(gRNA_dictionary$precomp_file)
# 2. Gene precomputations
genes <- unique(gRNA_gene_pairs$gene_id)
genes
create_precomp_dictionary(ids = genes, pod_size = 212)
genes
create_precomp_dictionary(ids = genes, pod_size = 212)
# 2. Gene precomputations
genes <- unique(gRNA_gene_pairs$gene_id)
gene_dictionary <- create_precomp_dictionary(ids = genes, pod_size = 212) %>% mutate(offset_file = paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_offsets_", pod_id, ".fst") %>% factor(), dispersion_file = paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_dispersion_", pod_id, ".fst"))
gene_dictionary
# 2. Gene precomputations
genes <- unique(gRNA_gene_pairs$gene_id)
gene_dictionary <- create_dictionary(ids = genes, pod_size = 212) %>% mutate(offset_file = paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_offsets_", pod_id, ".fst") %>% factor(), dispersion_file = paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_dispersion_", pod_id, ".fst"))
library(sceptre)
library(sceptre)
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
# Load the gRNAs and genes to analyze
gRNA_gene_pairs <- read.fst(paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst"))
head(gRNA_gene_pairs)
# 1. gRNA precomputations
gRNAs <- unique(gRNA_gene_pairs$gRNA_group)
gRNA_dictionary <- create_dictionary(ids = gRNAs, pod_size = 400) %>% mutate(precomp_file = factor(paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_precomp_", pod_id, ".fst")))
head(gRNA_dictionary)
write.fst(gRNA_dictionary, paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_dictionary.fst"))
# 2. Gene precomputations
genes <- unique(gRNA_gene_pairs$gene_id)
gene_dictionary <- create_dictionary(ids = genes, pod_size = 212) %>% mutate(offset_file = paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_offsets_", pod_id, ".fst") %>% factor(), dispersion_file = paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_dispersion_", pod_id, ".fst"))
head(gene_dictionary)
gene_dictionary <- create_dictionary(ids = genes, pod_size = 212) %>% mutate(offset_file = paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_offsets_", pod_id, ".fst") %>% factor(), dispersion_file = paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_dispersion_", pod_id, ".fst") %>% factor())
gene_dictionary$offset_file
gene_dictionary$dispersion_file
# 3. gRNA-gene pairs
pairs <- create_dictionary(ids = gRNA_gene_pairs$gRNA_group, pod_size = 2000, precomp_base_filename = paste0(offsite_dir, "/results/gasperini"))
# 3. gRNA-gene pairs
pairs <- create_dictionary(ids = gRNA_gene_pairs$gRNA_group, pod_size = 2000)
pairs
pairs <- rename(pairs, gRNA_id = id) %>% mutate(gene_id = gRNA_gene_pairs$gene_id) %>% select(gRNA_id, gene_id, pod_id, file_name)
pairs <- rename(pairs, gRNA_id = id) %>% mutate(gene_id = gRNA_gene_pairs$gene_id) %>% select(gRNA_id, gene_id, pod_id)
pairs
offsite_dir
pairs <- rename(pairs, gRNA_id = id) %>% mutate(gene_id = gRNA_gene_pairs$gene_id) %>% select(gRNA_id, gene_id, pod_id) %>% mutate(result_file = paste0(offsite_dir, "/results/gasperini/result_file_", pod_id, ".fst"))
# 3. gRNA-gene pairs
pairs <- create_dictionary(ids = gRNA_gene_pairs$gRNA_group, pod_size = 2000)
head(pair)
head(pairs)
rename(pairs, gRNA_id = id)
rename(pairs, gRNA_id = id) %>% mutate(gene_id = gRNA_gene_pairs$gene_id)
rename(pairs, gRNA_id = id) %>% mutate(gene_id = gRNA_gene_pairs$gene_id) %>% select(gRNA_id, gene_id, pod_id)
rename(pairs, gRNA_id = id) %>% mutate(gene_id = gRNA_gene_pairs$gene_id) %>% select(gRNA_id, gene_id, pod_id) %>% mutate(result_file = paste0(offsite_dir, "/results/gasperini/result_file_", pod_id, ".fst"))
pairs <- rename(pairs, gRNA_id = id) %>% mutate(gene_id = gRNA_gene_pairs$gene_id) %>% select(gRNA_id, gene_id, pod_id) %>% mutate(result_file = paste0(offsite_dir, "/results/gasperini/result_file_", pod_id, ".fst"))
pairs$result_file[1]
pairs <- rename(pairs, gRNA_id = id) %>% mutate(gene_id = gRNA_gene_pairs$gene_id) %>% select(gRNA_id, gene_id, pod_id) %>% mutate(result_file = paste0(offsite_dir, "/results/gasperini/result_", pod_id, ".fst"))
pairs <- rename(pairs, gRNA_id = id) %>% mutate(gene_id = gRNA_gene_pairs$gene_id) %>% select(gRNA_id, gene_id, pod_id) %>% mutate(result_file = paste0(offsite_dir, "/results/gasperini/result_", pod_id, ".fst"))
pairs <- rename(pairs, gRNA_id = id) %>% mutate(gene_id = gRNA_gene_pairs$gene_id) %>% select(gRNA_id, gene_id, pod_id) %>% mutate(result_file = paste0(offsite_dir, "/results/gasperini/result_", pod_id, ".fst"))
# 3. gRNA-gene pairs
pairs <- create_dictionary(ids = gRNA_gene_pairs$gRNA_group, pod_size = 2000) %>% rename(gRNA_id = id) %>% mutate(gene_id = gRNA_gene_pairs$gene_id) %>% select(gRNA_id, gene_id, pod_id) %>% mutate(result_file = paste0(offsite_dir, "/results/gasperini/result_", pod_id, ".fst"))
pairs
head(pairs)
pairs$result_file[1]
write.fst(pairs, paste0(offsite_dir, "/results/gasperini/results_dictionary.fst"))
paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_dictionary.fst")
# Create and store dictionary files
gRNA_gene_pairs <- read.fst(paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst"))
# Create and store dictionary files
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
# Create and store dictionary files
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
gRNA_gene_pairs <- read.fst(paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst"))
gRNA_precomp_dir <- paste0(offsite_dir, "/data/gasperini/precomp/gRNA/gRNA_dictionary.fst")
gene_dictionary <- paste0(offsite_dir, "/data/gasperini/precomp/gene/gene_dictionary.fst")
offsite_dir
gRNA_gene_pairs
gRNA_precomp_dir
gene_dictionary
# Create and store dictionary files
offsite_dir <- "/Volumes/tims_new_drive/research/sceptre_files"
gRNA_gene_pairs <- read.fst(paste0(offsite_dir, "/data/gasperini/processed/gene_gRNA_pairs_to_study.fst"))
head(gRNA_gene_pairs)
gRNA_precomp_dir <- paste0(offsite_dir, "/data/gasperini/precomp/gRNA")
gene_precomp_dir <- paste0(offsite_dir, "/data/gasperini/precomp/gene")
results_dir <- paste0(offsite_dir, "/results/gasperini")
gRNA_precomp_dir
gene_precomp_dir
results_dir
